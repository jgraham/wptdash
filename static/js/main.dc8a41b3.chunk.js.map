{"version":3,"sources":["form.js","urlparams.js","filter.js","filterselector.js","metaeditor.js","utils.js","notification.js","App.js","serviceWorker.js","index.js"],"names":["Checkbox","Component","constructor","props","super","handleChange","event","this","setState","checked","target","onCheckboxChange","value","state","render","name","type","onChange","TextInput","defaultValue","list","Select","selectItems","options","map","option","key","SelectMultiple","selectedOptions","call","x","selected","size","multiple","urlParams","url","URL","window","location","params","searchParams","_update","history","replaceState","document","title","href","get","has","set","delete","append","FilterError","Error","handlers","and","data","Array","isArray","args","child","push","filterCompiler","operators","or","not","in","ctx","every","some","lhs","rhs","arg","ctxValue","getValue","includes","undefined","keyParts","split","part","Map","input","keys","Object","length","console","error","op","hasOwnProperty","ParseError","operatorTokens","Set","unaryOperators","precedenceGroups","operatorPrecedence","i","groupIdx","group","operatorAliases","entries","defaultOperator","test","Node","to_object","obj","children","UnaryOperatorNode","operand","BinaryOperatorNode","ValueNode","slice","createOperatorNode","token","Parser","operands","top","parse","tokens","apply","pop","precedence","operator","transformDefaultOperator","parseExpr","expr","space","term","initialLength","m","match","skip","tokenize","Filter","types","none","filter","untriaged","queryTerms","link","triaged","custom","onTypeChange","afterTypeChange","onExprChange","ast","clearTimeout","timer","e","setTimeout","log","urlValue","parts","join","componentDidUpdate","prevProps","prevState","afterFilterUpdate","typeData","triageText","className","optionText","from","MetadataEditor","changes","id","rel","onSubmit","onCancel","MetadataPendingChanges","listItems","change","subtest","onClick","arraysEqual","a","b","a_value","setsEqual","elem","iterMapSorted","cmp","sort","enumerate","iter","count","item","NotificationArea","onDismiss","onDismissNotification","notifications","idx","notification","level","content","Notification","extraControls","retry","timeout","TASK_QUEUE_BASE","passStatuses","browsers","LOADING_STATE","freeze","NONE","LOADING","COMPLETE","bugLinkRe","makeWptFyiUrl","path","staging","defaults","forEach","capitalize","str","toUpperCase","FetchError","resp","message","status","statusText","async","fetchJson","fetch","ok","json","anyRe","workerRe","testToPath","pathname","exec","makeNotification","App","onError","err","notify","findIndex","splice","onFilterChange","filterFunc","onRunChange","runSha","onMetadataPendingSubmit","isMatch","product","changedMeta","metadataPendingChanges","meta","prevMetadata","wptMetadata","results","result","newMeta","index","prUrl","patchMetadata","onMetadataPendingCancel","onMetadataChange","onComponentChange","component","canonicalComponent","toLowerCase","selectedPaths","bugComponentsMap","currentBugComponent","onPathsChange","pathsArray","bugComponents","wptRuns","geckoMetadata","pathGeckoMetadata","haveData","bugComponent","wptRun","concat","body","JSON","stringify","hostname","method","mode","cache","credentials","headers","text","redirect","indexName","artifactName","runId","loadTaskClusterData","taskId","fetchData","taskStatus","run","array","reversed","runs","artifactData","artifacts","find","artifact","endsWith","componentData","processComponentData","components","componentsMap","urlPaths","aligned","runsUrl","loadWptRunData","full_revision_hash","metaUrl","metadata","loadWptMetadata","Promise","all","loadBugComponentData","loadGeckoMetadata","filterGeckoMetadata","makeRe","pathPrefixes","RegExp","pathRe","notPaths","values","notPathRe","allMetadata","paths","pathToComponent","componentToPath","wptRoot","stack","testing","tests","pathTrimRe","basePath","found","filename","relPath","label","RunInfo","onInputChange","newSha","onEditClick","editable","onUpdateClick","runShas","browserRuns","revision","add","browser_name","sha","BrowserInfo","browser_version","os_name","BugComponentSelector","TestPaths","disabled","ResultsView","onBrowserChange","passesIn","failsIn","defaultBrowsers","comparison","getComparison","loading_state","filteredResults","rv","listValue","buildQuery","query","run_ids","topAndClause","browser","orClause","pattern","searchQuery","fetchResults","_wptMetadata","getWptMetadata","_geckoMetadata","getGeckoMetadata","metaEntry","dirParts","testName","dirPath","copyMeta","src","dirMeta","dirMetadata","_tests","testMetadata","_subtests","updateFilteredResults","testItems","legacy_status","total","reduce","y","fetchIfPossible","ResultsViewSummary","onSelectChange","newPassesIn","newFailsIn","joinList","items","passInOptions","failInOptions","TreeRow","handleClick","showDetails","expanded","rowId","rowTitle","rowExtra","TestItem","hash","TestDetails","loaded","processResultData","resultBySubtest","browserResults","subtests","resultByBrowser","filteredResultBySubtest","resultData","promises","results_url","promise","then","success","catch","resolved","headerRow","subtestMetadata","resultRows","WptTestMetadata","newLinkValue","onAddLink","bugUrl","addLink","onRemoveLink","componentDidMount","filterBugLinks","bugLinks","controlElements","onRemove","fxMetadata","relevantResults","MetadataBugLink","GeckoMetaSummary","renderBug","metaProps","prop","InlineOrTreeMetadata","ResultRow","cells","ResultCell","GeckoData","groupData","unconditional","conditional","intermittent","lsan","crashes","dest","mapFn","destKey","dir","dirData","expected_CRASH","cond","testData","testKey","subtestData","subtestKey","byType","typeValues","desc","GeckoDataSection","GeckoMetadataLine","condition","conditionStr","valueList","MaybeBugLink","bugNumberRe","re","LsanListValue","frames","StatusListValue","statuses","prev","current","Tabs","handleClickTab","activeTab","tabItems","active","activeTabContent","Tab","Boolean","ReactDOM","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.dc8a41b3.chunk.js","sourcesContent":["import React, { Component } from 'react';\n\nexport class Checkbox extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            checked: this.props.checked\n        };\n    }\n\n    handleChange = (event) => {\n        this.setState({checked: event.target.checked ? true : false});\n        this.props.onCheckboxChange(this.props.value, event.target.checked);\n    }\n\n    render() {\n        return (<input\n                  name={this.props.name}\n                  type=\"checkbox\"\n                  checked={this.state.checked}\n                  onChange={this.handleChange} />);\n    }\n}\n\nexport class TextInput extends Component {\n    handleChange = (event) => {\n        let value = event.target.value;\n        this.props.onChange(value);\n    }\n\n    render() {\n        return (<input\n                  name={this.props.name}\n                  onChange={this.handleChange}\n                  defaultValue={this.props.defaultValue}\n                  list={this.props.list}/>);\n    }\n}\n\n\nexport class Select extends Component {\n    handleChange = (event) => {\n        this.props.onChange(event.target.value);\n    }\n\n    render() {\n        let selectItems = this.props.options.map(option => <option value={option.value} key={option.value}>{option.name}</option>);\n        return (<select\n                  onChange={this.handleChange}\n                  value={this.props.value}>\n                  {selectItems}\n                </select>);\n    }\n}\n\nexport class SelectMultiple extends Component {\n    handleChange = (event) => {\n        let selectedOptions = event.target.selectedOptions;\n        this.props.onChange([].map.call(selectedOptions, x => x.value));\n    }\n\n    render() {\n        let selectItems = this.props.options.map(option => <option value={option.value} key={option.value} selected={option.selected}>\n                                                 {option.name}\n                                                 </option>);\n        return (<select\n                  size=\"3\"\n                  multiple\n                  onChange={this.handleChange}>\n                  {selectItems}\n                </select>);\n    }\n}\n\nexport class DataList extends Component {\n    render() {\n        let items = this.props.options.map(option => <option value={option} key={option}/>);\n        return (<datalist id={this.props.id}>\n                  {items}\n                </datalist>);\n    }\n}\n","class UrlParams {\n    constructor() {\n        this.url = new URL(window.location);\n        this.params = this.url.searchParams;\n    }\n\n    _update() {\n        window.history.replaceState({}, document.title, this.url.href);\n    }\n\n    get(name) {\n        return this.params.get(name);\n    }\n\n    has(name) {\n        return this.params.has(name);\n    }\n\n    set(name, value) {\n        this.params.set(name, value);\n        this._update();\n    }\n\n    delete(name) {\n        this.params.delete(name);\n        this._update();\n    }\n\n    append(name, value) {\n        this.params.append(name, value);\n        this._update();\n    }\n}\n\nexport const urlParams = new UrlParams();\n","class FilterError extends Error {};\n\nlet handlers = {\n    and: (data) => {\n        if (!Array.isArray(data)) {\n            throw new FilterError(\"Argument to 'and' clause must be an array\");\n        }\n        let args = [];\n        for (let child of data) {\n            args.push(filterCompiler(child));\n        }\n        return operators.and(...args);\n    },\n\n    or: (data) => {\n        if (!Array.isArray(data)) {\n            throw new FilterError(\"Argument to 'or' clause must be an array\");\n        }\n        let args = [];\n        for (let child of data) {\n            args.push(filterCompiler(child));\n        }\n        return operators.or(...args);\n    },\n\n    \"==\": (data)  => {\n        return operators[\"==\"](data);\n    },\n\n    not: ([data]) => {\n        return operators.not(filterCompiler(data));\n    },\n\n    in: (data) => {\n        return operators.in(data);\n    },\n\n    has: ([data]) => {\n        if (typeof data !== \"string\") {\n            throw new FilterError(\"Argument to 'has' clause must be a string\");\n        }\n        return operators.has(data);\n    }\n};\n\nlet operators = {\n    and: (...args) => {\n        return (ctx) => {\n            return args.every(x => x(ctx));\n        };\n    },\n\n    or: (...args) => {\n        return (ctx) => args.some(x => x(ctx));\n    },\n\n    \"==\": ([lhs, rhs]) => {\n        return lhs === rhs;\n    },\n\n    not: (arg) => {\n        return (ctx) => !arg(ctx);\n    },\n\n    in: ([lhs, rhs]) => {\n        return (ctx) => {\n            let ctxValue = getValue(ctx, rhs);\n            if (typeof ctxValue !== \"string\") {\n                throw new FilterError();\n            }\n            return ctxValue.includes(lhs);\n        };\n    },\n\n    has: (arg) => {\n        return (ctx) => {\n            let ctxValue = getValue(ctx, arg);\n            return ctxValue !== undefined;\n        };\n    }\n};\n\nfunction getValue(ctx, key) {\n    let keyParts = key.split(\".\");\n    let target = ctx;\n    for (let part of keyParts) {\n        if (target instanceof Map) {\n            target = target.get(part);\n        } else {\n            target = target[part];\n        }\n        if (target === undefined) {\n            return undefined;\n        }\n    }\n    return target;\n}\n\nexport function filterCompiler(input) {\n    let keys = Object.keys(input);\n    if (keys.length !== 1) {\n        console.error(input);\n        throw new FilterError(\"Can't handle an input with multiple keys\");\n    }\n    let op = keys[0];\n    if (!handlers.hasOwnProperty(op)) {\n        console.error(input);\n        throw new FilterError(`Unknown operator ${op}`);\n    }\n    return handlers[op](input[op]);\n}\n\nclass ParseError extends Error{};\n\nfunction* tokenize(input) {\n    let space = /\\s*/;\n    let term = /\\w(?:\\w|\\d|\\.|_|-|\\+|\\/)*|\\d+|==|!=|\\(|\\)|:|\".*?[^\\\\]\"|'.*?[^\\\\]'/;\n\n    let initialLength = input.length;\n\n    while (input.length) {\n        // Skip spaces\n        let m = input.match(space);\n        if (m[0].length) {\n            let skip = m[0].length;\n            input = input.slice(skip);\n            if (!input.length) {\n                break;\n            }\n        }\n\n        //Match the next token\n        m = input.match(term);\n        if (!m) {\n            throw new ParseError(`Invalid input at character ${initialLength - input.length}`);\n        }\n        let token = m[0];\n        yield token;\n        input = input.slice(token.length);\n    }\n}\n\nconst operatorTokens = new Set([\"==\", \"!=\", \"in\", \"and\", \"or\", \"!\", \"not\", \":\", \"has\"]);\nconst unaryOperators = new Set([\"!\", \"not\", \"has\"]);\n\nconst precedenceGroups = [[\":\"], [\"in\", \"==\", \"!=\", \"has\"], [\"not\", \"!\"], [\"and\"], [\"or\"]];\nconst operatorPrecedence = new Map();\n\nfor (let [groupIdx, group] of precedenceGroups.map((x, i) => [i, x])) {\n    for (let op of group) {\n        operatorPrecedence.set(op, precedenceGroups.length - groupIdx);\n    }\n}\n\nconst operatorAliases = new Map(Object.entries({\"!\": \"not\"}));\n\nconst defaultOperator = new Map(Object.entries({test: \"in\"}));\n\n\nclass Node {\n    constructor(name) {\n        this.name = name;\n    }\n\n    to_object() {\n        let obj = {};\n        obj[this.name] = this.children().map(x => x.to_object());\n        return obj;\n    }\n}\n\nclass UnaryOperatorNode extends Node {\n    constructor(name) {\n        if (!operatorTokens.has(name) || !unaryOperators.has(name)) {\n            throw new Error();\n        }\n        if (operatorAliases.has(name)) {\n            name = operatorAliases.get(name);\n        }\n\n        super(name);\n        this.operand = null;\n    }\n\n    children() {\n        return [this.operand];\n    }\n}\n\nclass BinaryOperatorNode extends Node {\n    constructor(name) {\n        if (!operatorTokens.has(name) || unaryOperators.has(name)) {\n            throw new Error();\n        }\n        if (operatorAliases.has(name)) {\n            name = operatorAliases.get(name);\n        }\n\n        super(name);\n        this.lhs = null;\n        this.rhs = null;\n    }\n\n    children() {\n        return [this.lhs, this.rhs];\n    }\n}\n\nclass ValueNode extends Node {\n    constructor(name) {\n        if (name[0] === \"'\" || name[0] === '\"') {\n            name = name.slice(1, name.length - 1);\n        }\n        super(name);\n    }\n    to_object() {\n        return this.name;\n    }\n}\n\nfunction createOperatorNode(token) {\n    if (unaryOperators.has(token)) {\n        return new UnaryOperatorNode(token);\n    }\n    return new BinaryOperatorNode(token);\n}\n\nfunction transformDefaultOperator(operator) {\n    // The default operator creates a different kind of relation depending on the arguments\n    let op = \"==\";\n    if (defaultOperator.has(operator.lhs.name)) {\n        op = defaultOperator.get(operator.lhs.name);\n    }\n    operator.name = op;\n    if (op === \"in\") {\n        [operator.lhs, operator.rhs] = [operator.rhs, operator.lhs];\n    }\n    return operator;\n}\n\nclass Parser {\n    constructor() {\n        this.operators = [];\n        this.operands = [];\n    }\n\n    top() {\n        return this.operators.length ? this.operators[this.operators.length - 1] : null;\n    }\n\n    parse(tokens) {\n        for (let token of tokens) {\n            if (token === \"(\") {\n                this.operators.push(token);\n            } else if (token === \")\") {\n                while(this.top() !== null && this.top() !== \"(\") {\n                    this.apply();\n                }\n                if (!this.operators.length) {\n                    throw new ParseError(\"Mismatched parens\");\n                }\n                this.operators.pop();\n            } else if (operatorTokens.has(token)) {\n                while (this.top() !== null &&\n                       this.top() !== \")\" &&\n                       this.precedence(this.top().name) >= this.precedence(token)) {\n                    this.apply();\n                }\n                this.operators.push(createOperatorNode(token));\n            } else {\n                this.operands.push(new ValueNode(token));\n            }\n        }\n        while (this.operators.length) {\n            this.apply();\n        }\n        if (this.operands.length !== 1) {\n            throw new ParseError(\"Operands remaining at end of input\");\n        }\n        return this.operands[0];\n    }\n\n    precedence(token) {\n        return operatorPrecedence.get(token);\n    }\n\n    apply() {\n        let operator = this.operators.pop();\n        if (unaryOperators.has(operator.name)) {\n            let operand = this.operands.pop();\n            if (!operand) {\n                throw new Error();\n            }\n            operator.operand = operand;\n        } else {\n            let rhs = this.operands.pop();\n            let lhs = this.operands.pop();\n            if (!lhs || !rhs) {\n                throw new Error();\n            }\n            operator.lhs = lhs;\n            operator.rhs = rhs;\n            if (operator.name === \":\") {\n                operator = transformDefaultOperator(operator);\n            }\n        }\n        this.operands.push(operator);\n    }\n}\n\n\nexport function parseExpr(expr) {\n    let parser = new Parser();\n    return parser.parse(tokenize(expr)).to_object();\n}\n","import React, { Component } from 'react';\nimport {TextInput, Select} from './form';\nimport {urlParams} from './urlparams';\nimport {filterCompiler, parseExpr} from './filter';\n\nexport class Filter extends Component {\n    types = new Map(Object.entries({none: {name: \"None\", filter: null},\n                                    untriaged: {name: \"Untriaged\", filter: null,\n                                                queryTerms: [{not: {link: \"bugzilla.mozilla.org\"}}]},\n                                    triaged: {name: \"Triaged\", filter: null,\n                                              queryTerms: [{link: \"bugzilla.mozilla.org\"}]},\n                                    custom: {name: \"Custom…\", filter: null, queryTerms: []}}));\n\n    constructor(props) {\n        super(props);\n        let [type, expr] = [\"none\", null];\n        let urlValue = urlParams.get(\"filter\");\n        if (urlValue) {\n            let parts = urlValue.split(\":\");\n            type = parts[0];\n            expr = parts.slice(1).join(\":\");\n        }\n        if (!this.types.has(type)) {\n            type = \"none\";\n            expr = null;\n        }\n        if (type !== \"custom\") {\n            expr = this.types.get(type).filter;\n        }\n        this.state = {type, expr};\n        this.afterTypeChange(type);\n        if (expr) {\n            this.onExprChange(expr);\n        }\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        if (prevState.type !== this.state.type ||\n            prevState.expr !== this.state.expr) {\n            this.afterFilterUpdate();\n        }\n    }\n\n    onTypeChange = (type) => {\n        if (!this.types.has(type)) {\n            return;\n        }\n        this.setState({type: type});\n        this.afterTypeChange(type);\n    }\n\n    afterTypeChange(type) {\n        let expr;\n        let queryTerms = [];\n        if (type === \"custom\") {\n            expr = this.state.expr;\n        } else {\n            let typeData = this.types.get(type);\n            expr = typeData.filter;\n            queryTerms = typeData.queryTerms || [];\n        }\n        let filter;\n        if (expr) {\n            filter = filterCompiler(parseExpr(expr));\n        }\n        this.props.onChange(filter, queryTerms);\n    }\n\n    onExprChange = (expr) => {\n        let ast;\n        clearTimeout(this.timer);\n        try {\n            ast = expr ? parseExpr(expr) : null;\n        } catch (e) {\n            this.timer = setTimeout(() => {\n                //TODO: Add UI errors for things that won't compile\n                console.log(e);\n            }, 1000);\n            return;\n        }\n        this.timer = setTimeout(() => {\n            let filter;\n            try {\n                filter = ast ? filterCompiler(ast) : null;\n            } catch(e) {\n                console.error(e);\n                return;\n            }\n            this.props.onChange(filter, []);\n            this.setState({expr});\n        }, 1000);\n    }\n\n    afterFilterUpdate() {\n        let type = this.state.type;\n        if (type === \"none\") {\n            urlParams.delete(\"filter\");\n        } else if(type === \"custom\") {\n            let expr = this.state.expr;\n            urlParams.set(\"filter\", `custom:${expr}`);\n        } else {\n            urlParams.set(\"filter\", type);\n        }\n    }\n\n    render() {\n        let triageText = <p className=\"note\">\n                           Triaged status is determined by a bugzilla link for the test in the&nbsp;\n                           <a href=\"https://github.com/web-platform-tests/wpt-metadata\">wpt-metadata</a> repository.\n                         </p>;\n        let optionText = {\n            \"triaged\": triageText,\n            \"untriaged\": triageText,\n            \"custom\": (<div className=\"note\">\n                         <p>\n                           Custom filters are boolean expressions with logical operators\n                           &nbsp;<code>and</code>, <code>or</code>, and <code>not</code>`,\n                           equality operators <code>{\"==\"}</code>, and <code>!=</code>\n                           and custom operators <code>in</code> for text substrings\n                           and <code>has</code> for testing if a field exists.\n                         </p>\n                         <p>\n                           Available fields are <code>test</code> for the test title and\n                           <code>_geckoMetadata</code> for fields set from gecko metadata\n                           Gecko metadata fields include <code>bug</code> and\n                           <code>lsan-allowed</code>\n                         </p>\n                         <p>\n                           The <code>:</code> operator performs a default operation depending\n                           on the selected field</p>\n                         <p>\n                           Examples:\n                         </p>\n                         <ul>\n                           <li><code>historical in test</code> - The test name contains\n                             the substring \"historical\"</li>\n                           <li><code>test:historical</code> - The test name contains\n                             the substring \"historical\"</li>\n                           <li><code>not has _geckoMetadata.bug</code> - Gecko metadata doesn't\n                             specify a bug field for the test</li>\n                           <li><code>not has _geckoMetadata.bug</code> - Gecko metadata doesn't\n                             specify a bug field for the test</li>\n                         </ul>\n                        </div>)\n        };\n        let options = Array.from(this.types).map(([value, {name}]) => ({value, name}));\n        return [<dt key=\"term\">Filter:</dt>,\n                (<dd key=\"value\">\n                   <Select options={options}\n                           value={this.state.type}\n                           onChange={this.onTypeChange}/>\n                   {this.state.type === \"custom\" ? <TextInput onChange={this.onExprChange}\n                                                              defaultValue={this.state.expr}/> : null}\n                   {optionText.hasOwnProperty(this.state.type) ?\n                    optionText[this.state.type] : null}\n                 </dd>)];\n    }\n}\n","import React, { Component } from 'react';\n\nexport class MetadataEditor extends Component {\n    render() {\n        if (!this.props.changes.size) {\n            return null;\n        }\n        let loginUrl = `https://staging.wpt.fyi/login`;\n        return (<section id=\"metadata\">\n                  <h3>Metadata Changes</h3>\n                  <p>Submitting MetaData requires first signing in to <a href={loginUrl} target=\"_blank\" rel=\"noopener noreferrer\">staging.wpt.fyi</a></p>\n                  <MetadataPendingChanges\n                    changes={this.props.changes}\n                    onSubmit={this.props.onSubmit}\n                    onCancel={this.props.onCancel} />\n                </section>);\n    };\n}\n\n\nclass MetadataPendingChanges extends Component {\n    render() {\n        let listItems = [];\n        for (let [test, changes] of this.props.changes.entries()) {\n            for (let change of changes) {\n                listItems.push(<li key={change.test + change.url}>{test} | {change.subtest} | {change.change} | {change.url}</li>);\n            }\n        }\n        return (<div>\n                  <details>\n                  <summary>Pending Changes</summary>\n                    <ol>\n                      {listItems}\n                    </ol>\n                  </details>\n                  <div>\n                    <button onClick={this.props.onSubmit}>Sumbit Changes</button>\n                    <button onClick={this.props.onCancel}>Cancel</button>\n                  </div>\n                </div>);\n    }\n}\n","export function* reversed(array) {\n    let index = array.length;\n    while (index > 0) {\n        index--;\n        yield array[index];\n    }\n};\n\nexport function arraysEqual(a, b) {\n    if (a === b) {\n        return true;\n    }\n    if (!Array.isArray(a) || !Array.isArray(b)) {\n        return false;\n    }\n    if (a.length !== b.length) {\n        return false;\n    }\n    return a.every((a_value, i) => a_value === b[i]);\n}\n\nexport function setsEqual(a, b) {\n    if (a.size !== b.size) {\n        return false;\n    }\n    for(let elem of a) {\n        if (!b.has(elem)) {\n            return false;\n        }\n    }\n    return true;\n}\n\nexport function* iterMapSorted(map, cmp) {\n    let keys = Array.from(map.keys());\n    keys.sort();\n    for (let key of keys) {\n        yield [key, map.get(key)];\n    }\n}\n\nexport function *enumerate(iter) {\n    let count = 0;\n    for (let item of iter) {\n        yield [count, item];\n        count++;\n    }\n}\n","import React, { Component } from 'react';\nimport {enumerate} from './utils';\n\nexport class NotificationArea extends Component {\n    onDismiss = (id) => {\n        this.props.onDismissNotification(id);\n    }\n\n    render() {\n        if (!this.props.entries.length) {\n            return null;\n        }\n        let notifications = [];\n        for (let [idx, notification] of enumerate(this.props.entries)) {\n            notifications.push(<Notification\n                                 key={`notification-${notification.id}`}\n                                 id={notification.id}\n                                 level={notification.level}\n                                 content={notification.content}\n                                 options={notification.options}\n                                 onDismiss={() => this.onDismiss(idx)}/>);\n        }\n        return (<ul className=\"notifications\">\n                  {notifications}\n                </ul>);\n    }\n}\n\nclass Notification extends Component {\n    constructor(props) {\n        super(props);\n        this.timer = null;\n    }\n\n    onDismiss = () => {\n        if (this.timer) {\n            clearTimeout(this.timer);\n            this.timer = null;\n        }\n        this.props.onDismiss(this.props.id);\n    }\n\n    render() {\n        let extraControls = [];\n        if (this.props.options.retry) {\n            let retry = () => {\n                this.props.onDismiss(this.props.id);\n                this.props.options.retry();\n            };\n            extraControls.push(<button onClick={retry} key=\"retry\">Retry</button>);\n        }\n        if (this.props.options.timeout) {\n            this.timer = setTimeout(this.onDismiss, this.props.options.timeout);\n        }\n        return (<li className={this.props.level}>\n                  {this.props.content}\n                  <button onClick={this.onDismiss}>Close</button>\n                  {extraControls}\n                </li>);\n    }\n}\n","import React, { Component } from 'react';\nimport './App.css';\nimport {Filter} from './filterselector';\nimport {Checkbox, TextInput, Select, SelectMultiple} from './form';\nimport {MetadataEditor} from './metaeditor';\nimport {NotificationArea} from './notification';\nimport {urlParams} from './urlparams';\nimport {arraysEqual, setsEqual, reversed, iterMapSorted, enumerate} from './utils';\n\nconst TASK_INDEX_BASE = \"https://firefox-ci-tc.services.mozilla.com/api/index/v1\";\nconst TASK_QUEUE_BASE = \"https://firefox-ci-tc.services.mozilla.com/api/queue/v1\";\n\nconst WPT_FYI_BASE = \"https://wpt.fyi\";\nconst WPT_FYI_STAGING_BASE = \"https://staging.wpt.fyi\";\n\nconst passStatuses = new Set([\"PASS\", \"OK\"]);\n\nconst browsers = [\"chrome\", \"firefox\", \"safari\"];\n\nconst LOADING_STATE = Object.freeze({\n    NONE: 0,\n    LOADING: 1,\n    COMPLETE: 2\n});\n\nconst bugLinkRe = /https?:\\/\\/bugzilla\\.mozilla\\.org\\/show_bug\\.cgi\\?id=(\\d+)/;\n\nfunction makeWptFyiUrl(path, params={}, staging=false) {\n    let base = staging ? WPT_FYI_STAGING_BASE : WPT_FYI_BASE;\n    let url = new URL(`${base}/${path}`);\n    let defaults = [[\"label\", \"master\"],\n                    [\"product\", \"chrome[experimental]\"],\n                    [\"product\", \"firefox[experimental]\"],\n                    [\"product\", \"safari[experimental]\"]];\n    params = new Map(Object.entries(params));\n    for (let [key, value] of defaults) {\n        if (!params.has(key)) {\n            url.searchParams.append(key, value);\n        }\n    }\n    for (let [key, value] of params) {\n        if (value === null || value === undefined) {\n            continue;\n        }\n        if (Array.isArray(value)) {\n            value.forEach(x => url.searchParams.append(key, x));\n        } else {\n            url.searchParams.append(key, value);\n        }\n    }\n    return url;\n}\n\nfunction capitalize(str) {\n    if (str) {\n        return str && str[0].toUpperCase() + str.slice(1);\n    } else {\n        return \"\";\n    }\n}\n\nclass FetchError extends Error {\n    constructor(resp, message=null) {\n        if (!message) {\n            message = `Fetch for ${resp.url} returned status ${resp.status} ${resp.statusText}`;\n        }\n        super(message);\n        this.resp = resp;\n        this.name = \"FetchError\";\n    }\n}\n\nasync function fetchJson(url, options) {\n    let resp = await fetch(url, options);\n    if (!resp.ok) {\n        throw new FetchError(resp);\n    }\n    return await resp.json();\n}\n\n\nconst anyRe = /^(.*\\.any)(:?\\..*)\\.html$/;\nconst workerRe = /^(.*\\.(:?worker|window))\\.html$/;\n\nfunction testToPath(test) {\n    let url = new URL(`https://web-platform.test${test}`);\n    let path = url.pathname;\n    let match = anyRe.exec(path);\n    if (match === null) {\n        match = workerRe.exec(path);\n    }\n    if (match !== null) {\n        path = match[1] + '.js';\n    }\n    return path;\n}\n\nlet makeNotification = (() => {\n    let id = -1;\n    return (level, content, options) => {\n        id++;\n        return {id, level, content, options};\n    };\n})();\n\nclass App extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            bugComponents: [],\n            bugComponentsMap: new Map(),\n            currentBugComponent: null,\n            selectedPaths: new Set(),\n            runSha: null,\n            wptRuns: null,\n            wptMetadata: null,\n            geckoMetadata: {},\n            pathGeckoMetadata: {},\n            notifications: [],\n            haveData: {\n                bugComponent: false,\n                geckoMetadata: false,\n                wptMetadata: false,\n                wptRun: false,\n            },\n            filter: null,\n            filterFunc: null,\n            queryTerms: [],\n            metadataPendingChanges: new Map(),\n        };\n    }\n\n    onError = (err, options={}) => {\n        let content = err.message || \"Unknown Error\";\n        this.notify(\"error\", content, options);\n    }\n\n    onDismissNotification = (id) => {\n        let notifications = Array.from(this.state.notifications);\n        let idx = notifications.findIndex(x => x.id === id);\n        if (idx === undefined) {\n            return;\n        }\n        notifications.splice(idx, 1);\n        this.setState({notifications});\n    }\n\n    onFilterChange = (filterFunc, queryTerms) => {\n        this.setState({filterFunc, queryTerms});\n    }\n\n    onRunChange = (runSha) => {\n        this.setState({runSha});\n    }\n\n    onMetadataPendingSubmit = async () => {\n        let isMatch = (item, change) => (item.product === \"firefox\" &&\n                                         item.url === change.url &&\n                                         (!(item.subtest || change.subtest) || (item.subtest === change.subtest)) &&\n                                         (!(item.status || change.status) || (item.status === change.status)));\n        let changedMeta = {};\n        for (let [test, changes] of this.state.metadataPendingChanges) {\n            // Flatten out the metadata\n            let meta = [];\n            let prevMetadata = this.state.wptMetadata[test];\n            if (prevMetadata) {\n                for (let item of prevMetadata) {\n                    if (item.results) {\n                        for (let result of item.results) {\n                            meta.push({...item, ...result});\n                        }\n                    } else {\n                        meta.push({...item});\n                    }\n                }\n            }\n\n            for (let change of changes) {\n                if (change.change === \"REMOVE\") {\n                    meta = meta.filter(item => !isMatch(item, change));\n                } else if (change.change === \"ADD\") {\n                    if (!meta.some(item => isMatch(item, change))) {\n                        let newMeta = {product: \"firefox\",\n                                       url: change.url};\n                        if (change.subtest) {\n                            newMeta.subtest = change.subtest;\n                        }\n                        if (change.status) {\n                            newMeta.status = change.status;\n                        }\n                        meta.push(newMeta);\n                    }\n                }\n            }\n            changedMeta[test] = [];\n            // Now unflatten the metadata\n            let index = new Map();\n            for (let newMeta of meta) {\n                let key = [newMeta.product, newMeta.url].join(\",\");\n                if (!index.has(key)) {\n                    index.set(key, changedMeta[test].length);\n                    changedMeta[test].push({product: newMeta.product, url:newMeta.url});\n                }\n                if (newMeta.subtest || newMeta.status) {\n                    let item = changedMeta[test][index.get(key)];\n                    if (!item.results) {\n                        item.results = [];\n                    }\n                    let result = {};\n                    if (newMeta.subtest) {\n                        result.subtest = newMeta.subtest;\n                    }\n                    if (newMeta.status) {\n                        result.status = newMeta.status;\n                    }\n                    item.results.push(result);\n                }\n            }\n        }\n        let prUrl = await this.patchMetadata(changedMeta);\n        this.notify(\"info\",\n                    <span>Opened PR <a href={prUrl}>{prUrl}</a></span>,\n                    {timeout: 60000});\n        this.setState({metadataPendingChanges: new Map()});\n    }\n\n    onMetadataPendingCancel = () => {\n        this.setState({metadataPendingChanges: new Map()});\n    }\n\n    onMetadataChange = (change) => {\n        let metadataPendingChanges = new Map(this.state.metadataPendingChanges);\n        if (!metadataPendingChanges.has(change.test)) {\n            metadataPendingChanges.set(change.test, []);\n        }\n        // TODO: consolidate changes\n        metadataPendingChanges.get(change.test).push(change);\n        this.setState({metadataPendingChanges});\n    }\n\n    notify(level, content, options={}) {\n        let notification = makeNotification(level, content, options);\n        this.setState(state => {return {notifications: state.notifications.concat(notification)};});\n    }\n\n    async patchMetadata(data) {\n        let body = JSON.stringify(data);\n        if (window.location.hostname !== \"jgraham.github.io\") {\n            this.onError(new Error(`Unable to submit data from ${window.location.hostname}`), {});\n            console.error(data);\n            return null;\n        }\n        let url = makeWptFyiUrl(\"api/metadata/triage\", {\"product\": \"firefox\"}, true);\n        const response = await fetch(url, {\n            method: 'PATCH',\n            mode: 'cors',\n            cache: 'no-cache',\n            credentials: 'include',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body\n        });\n        return response.text();\n    }\n\n    async fetchData(url, retry, options={}) {\n        if (!options.hasOwnProperty(\"redirect\")) {\n            options.redirect = \"follow\";\n        }\n        try {\n            return await fetchJson(url, options);\n        } catch(e) {\n            this.onError(e, {retry});\n            throw e;\n        }\n    }\n\n    async loadTaskClusterData(indexName, artifactName) {\n        let retry = async () => await this.loadTaskClusterData(indexName, artifactName);\n        let taskData = await this.fetchData(`${TASK_INDEX_BASE}/task/${indexName}`,\n                                            retry);\n        let taskId = taskData.taskId;\n        let taskStatus = await this.fetchData(`${TASK_QUEUE_BASE}/task/${taskId}/status`,\n                                              retry);\n        let runId;\n        for (let run of reversed(taskStatus.status.runs)) {\n            if (run.state === \"completed\") {\n                runId = run.runId;\n                break;\n            }\n        }\n        let artifacts = await this.fetchData(`${TASK_QUEUE_BASE}/task/${taskId}/runs/${runId}/artifacts`,\n                                             retry);\n        let artifactData = artifacts.artifacts.find(artifact => artifact.name.endsWith(artifactName));\n        return this.fetchData(`${TASK_QUEUE_BASE}/task/${taskId}/runs/${runId}/artifacts/${artifactData.name}`,\n                              retry);\n    }\n\n    async loadBugComponentData() {\n        // TODO - Error handling\n        this.setState({haveData: {...this.state.haveData, bugComponent: false}});\n        let componentData = await this.loadTaskClusterData(\"gecko.v2.mozilla-central.latest.source.source-bugzilla-info\",\n                                                           \"components-normalized.json\");\n\n        let [components, componentsMap] = this.processComponentData(componentData);\n        components = Array.from(components).sort();\n        components.push(\"Any\");\n\n        this.setState({\n            \"bugComponentsMap\": componentsMap,\n            \"bugComponents\": components\n        });\n\n        //TODO set paths from URL\n\n        let currentBugComponent = this.state.currentBugComponent;\n\n        if (!currentBugComponent && urlParams.has(\"bugComponent\")) {\n            let bugComponent = urlParams.get(\"bugComponent\");\n            if (componentsMap.has(bugComponent)) {\n                currentBugComponent = bugComponent;\n            }\n        }\n        if (!currentBugComponent) {\n            currentBugComponent = components[0].toLowerCase();\n        }\n\n        let selectedPaths = new Set(componentsMap.get(currentBugComponent));\n        if (urlParams.has(\"paths\")) {\n            let urlPaths = new Set(urlParams.get(\"paths\").split(\",\"));\n            selectedPaths = new Set(Array.from(selectedPaths).filter(x => urlPaths.has(x)));\n        }\n        this.setState({selectedPaths, currentBugComponent});\n        this.setState({haveData: {...this.state.haveData, bugComponent: true}});\n    }\n\n    async loadWptRunData() {\n        this.setState({haveData: {...this.state.haveData, wptRun: false}});\n        let params = {aligned: \"\"};\n        if (this.state.runSha) {\n            params[\"sha\"] = this.state.runSha;\n        }\n        let runsUrl = makeWptFyiUrl(\"api/runs\", params);\n        let runs = await this.fetchData(runsUrl, async () => this.loadWptRunData());\n        let runSha = runs[0].full_revision_hash;\n        this.setState({wptRuns: runs, runSha});\n        this.setState({haveData: {...this.state.haveData, wptRun: true}});\n    }\n\n    async loadWptMetadata() {\n        this.setState({haveData: {...this.state.haveData, wptMetadata: false}});\n        let params = {\"product\": [\"firefox\"]};\n        let metaUrl = makeWptFyiUrl(\"api/metadata\", params);\n        let metadata = await this.fetchData(metaUrl, async () => this.loadWptMetadata());\n        this.setState({wptMetadata: metadata});\n        this.setState({haveData: {...this.state.haveData, wptMetadata: true}});\n    }\n\n    async loadGeckoMetadata() {\n        this.setState({haveData: {...this.state.haveData, geckoMetadata: false}});\n        let metadata = await this.loadTaskClusterData(\"gecko.v2.mozilla-central.latest.source.source-wpt-metadata-summary\",\n                                                      \"summary.json\");\n        this.setState({geckoMetadata: metadata});\n        this.setState({haveData: {...this.state.haveData, geckoMetadata: true}});\n    }\n\n    async componentDidMount() {\n        await Promise.all([this.loadBugComponentData(),\n                           this.loadWptRunData(),\n                           this.loadWptMetadata(),\n                           this.loadGeckoMetadata()]);\n    }\n\n    filterGeckoMetadata() {\n        if (!this.state.selectedPaths.size || !Object.keys(this.state.geckoMetadata).length) {\n            return;\n        }\n        function makeRe(pathPrefixes) {\n            if (!pathPrefixes.length) {\n                return null;\n            }\n            return new RegExp(`^(?:${pathPrefixes.join(\"|\")})(?:$|/)`);\n        }\n        let pathRe = makeRe(Array.from(this.state.selectedPaths).map(x => x.slice(1)));\n\n        let notPaths = [];\n        for (let path of this.state.bugComponentsMap.values()) {\n            if (!this.state.selectedPaths.has(path) &&\n                pathRe.test(path.slice(1))) {\n                notPaths.push(path);\n            }\n        }\n        let notPathRe = makeRe(notPaths);\n        let data = {};\n        let allMetadata = this.state.geckoMetadata;\n        for (let key of Object.keys(allMetadata)) {\n            if (pathRe.test(key) && (notPathRe === null || !notPathRe.test(key))) {\n                data[key] = allMetadata[key];\n            }\n        }\n\n        this.setState({pathGeckoMetadata: data});\n    }\n\n    processComponentData(componentData) {\n        let componentsMap = componentData.components;\n        let paths = componentData.paths;\n        let pathToComponent = new Map();\n        let componentToPath = new Map();\n        let wptRoot = \"testing/web-platform/tests\";\n        let stack = [[wptRoot, paths.testing[\"web-platform\"].tests]];\n        let pathTrimRe = /(.*)\\/[^/]*$/;\n        let components = [];\n\n        componentToPath.set(\"any\", []);\n\n        while (stack.length) {\n            let [basePath, obj] = stack.pop();\n            let found = false;\n            for (let filename of Object.keys(obj)) {\n                let value = obj[filename];\n                if (typeof value === \"object\") {\n                    let path = `${basePath}/${filename}`;\n                    stack.push([path, value]);\n                } else {\n                    if (found || basePath === wptRoot) {\n                        continue;\n                    }\n                    let path = basePath;\n                    let component = componentsMap[value].join(\"::\");\n                    let canonicalComponent = component.toLowerCase();\n                    while (path !== wptRoot) {\n                        if (pathToComponent.has(path) && pathToComponent.get(path) === canonicalComponent) {\n                            found = true;\n                            break;\n                        }\n                        path = pathTrimRe.exec(path)[1];\n                    }\n                    if (!found) {\n                        pathToComponent.set(basePath, canonicalComponent);\n                        if (!componentToPath.has(canonicalComponent)) {\n                            componentToPath.set(canonicalComponent, []);\n                            components.push(component);\n                        };\n                        let relPath = basePath.slice(wptRoot.length);\n                        componentToPath.get(canonicalComponent).push(relPath);\n                        componentToPath.get(\"any\").push(relPath);\n                        found = true;\n                    }\n                }\n            }\n        }\n        return [components, componentToPath];\n    }\n\n    onComponentChange = (component) => {\n        let canonicalComponent = component.toLowerCase();\n        let selectedPaths = new Set(this.state.bugComponentsMap.get(canonicalComponent));\n        urlParams.set(\"bugComponent\", component);\n        urlParams.delete(\"paths\");\n        this.setState({currentBugComponent: canonicalComponent, selectedPaths});\n    }\n\n    onPathsChange = (selectedPaths) => {\n        let pathsArray = Array.from(selectedPaths);\n        pathsArray.sort();\n        if (!arraysEqual(pathsArray, this.state.bugComponentsMap.get(this.state.currentBugComponent))) {\n            urlParams.set(\"paths\", pathsArray.join(\",\"));\n        } else {\n            urlParams.delete(\"paths\");\n        }\n        this.setState({selectedPaths});\n    }\n\n    async componentDidUpdate(prevProps, prevState) {\n        if (prevState.geckoMetadata !== this.state.geckoMetadata ||\n            !arraysEqual(prevState.selectedPaths, this.state.selectedPaths)) {\n            this.filterGeckoMetadata();\n        }\n        if (prevState.runSha !== this.state.runSha) {\n            await this.loadWptRunData();\n        }\n    }\n\n    render() {\n        let paths = this.state.bugComponentsMap.get(this.state.currentBugComponent);\n        let body = [];\n        if (this.state.runSha) {\n            body.push(<section id=\"selector\" key=\"selector\">\n                        <dl>\n                          <RunInfo runSha={this.state.runSha}\n                                   onChange={this.onRunChange} />\n                          <BrowserInfo runs={this.state.wptRuns} />\n                          <BugComponentSelector onComponentChange={this.onComponentChange}\n                                                components={this.state.bugComponents}\n                                                value={this.state.currentBugComponent} />\n                          <Filter onChange={this.onFilterChange} />\n                          <TestPaths\n                            paths={paths}\n                            selectedPaths={this.state.selectedPaths}\n                            onChange={this.onPathsChange} />\n                        </dl>\n                        </section>);\n        }\n        if (Object.values(this.state.haveData).includes(false)) {\n            body.push(<section id=\"details\" key=\"details\">\n                        <p>Loading…</p>\n                      </section>);\n        } else {\n            body.push(\n                <section id=\"details\" key=\"details\">\n                  <Tabs>\n                    <ResultsView label=\"Interop Comparison\"\n                                 runs={this.state.wptRuns}\n                                 paths={this.state.selectedPaths}\n                                 geckoMetadata={this.state.pathGeckoMetadata}\n                                 wptMetadata={this.state.wptMetadata}\n                                 onError={this.onError}\n                                 filter={this.state.filterFunc}\n                                 queryTerms={this.state.queryTerms}\n                                 onMetadataChange={this.onMetadataChange}>\n                      <h2>Interop Comparison</h2>\n                    </ResultsView>\n                    <GeckoData label=\"Gecko Data\"\n                               data={this.state.pathGeckoMetadata}\n                               paths={this.state.selectedPaths}\n                               onError={this.onError}>\n                      <h2>Gecko metadata</h2>\n                      <p>Gecko metadata in <code>testing/web-platform/meta</code> taken from latest mozilla-central.</p>\n                      <p>Note: this data is currently not kept up to date</p>\n                    </GeckoData>\n                  </Tabs>\n                  <MetadataEditor changes={this.state.metadataPendingChanges}\n                                  onSubmit={this.onMetadataPendingSubmit}\n                                  onCancel={this.onMetadataPendingCancel} />\n                </section>);\n        }\n        return (\n            <div id=\"app\">\n              <NotificationArea\n                entries={this.state.notifications}\n                onDismissNotification={this.onDismissNotification}/>\n              <header>\n                <h1>wpt interop dashboard</h1>\n              </header>\n              {body}\n            </div>\n        );\n    }\n}\n\n\nclass RunInfo extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            editable: false,\n            newSha: null,\n            runShas: []\n        };\n    }\n\n    onInputChange = (value) => {\n        this.setState({newSha: value});\n    }\n\n    onEditClick = () => {\n        this.setState({editable: true});\n    }\n\n    onUpdateClick = () => {\n        this.props.onChange(this.state.newSha);\n        this.setState({editable: false});\n    }\n\n    async componentDidMount() {\n        let url = makeWptFyiUrl(\"/api/runs\", {\"max-count\": \"100\"});\n        let runs = await fetchJson(url);\n        let browserRuns = new Map();\n        for (let run of runs) {\n            if (!browserRuns.has(run.revision)) {\n                browserRuns.set(run.revision, new Set());\n            }\n            browserRuns.get(run.revision).add(run.browser_name);\n        }\n        let runShas = [];\n        for (let run of runs) {\n            if (browserRuns.has(run.revision) && browserRuns.get(run.revision).size === 3) {\n                runShas.push(run.revision);\n            }\n            browserRuns.delete(run.revision);\n        }\n        this.setState({runShas});\n    }\n\n    render() {\n        if (!this.props.runSha && !this.state.editable) {\n            return null;\n        }\n        let url = makeWptFyiUrl(\"\", {sha: this.props.runSha});\n        return [<dt key=\"term\">wpt SHA1:</dt>,\n                this.state.editable ?\n                 (<dd key=\"value\">\n                      {this.state.runShas ?\n                       (<datalist id=\"runShasData\">\n                          {this.state.runShas.map(x => <option key={x} value={x}/>)}\n                        </datalist>) : null}\n                    <TextInput defaultValue={this.props.runSha}\n                               onChange={this.onInputChange}\n                               list=\"runShasData\"/>\n                    <button onClick={this.onUpdateClick}>\n                      Update\n                    </button>\n                  </dd>):\n                 (<dd key=\"value\">\n                    <a href={url}>{this.props.runSha.slice(0,12)}</a>\n                    &nbsp;&nbsp;\n                    <button onClick={this.onEditClick}>\n                      Edit\n                    </button>\n                  </dd>\n                 )];\n    }\n}\n\nclass BrowserInfo extends Component {\n    render() {\n        if (!this.props.runs) {\n            return null;\n        }\n        let browsers = this.props.runs.map(run => {\n            return (<li key={run.browser_name}>\n               {capitalize(run.browser_name)} {run.browser_version} ({run.os_name})\n             </li>);\n        });\n        return [<dt key=\"term\">Browsers:</dt>,\n                (<dd key=\"value\">\n                   <ul>{browsers}</ul>\n                 </dd>)];\n    }\n}\n\nclass BugComponentSelector extends Component {\n    handleChange = (value) => {\n        this.props.onComponentChange(value);\n    }\n\n    render() {\n        let options = this.props.components.map(component => {\n            return {value:component.toLowerCase(), name:component};\n        });\n        if (!this.props.value) {\n            return null;\n        }\n        return [<dt key=\"term\">Bug Component:</dt>,\n                (<dd key=\"value\">\n                   <Select\n                     onChange={this.handleChange}\n                     value={this.props.value}\n                     options={options}/>\n                 </dd>)];\n    }\n}\n\nclass TestPaths extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            paths: new Set(this.props.paths)\n        };\n    }\n\n    onCheckboxChange = (path, checked) => {\n        let paths = new Set(this.state.paths);\n        if (checked) {\n            paths.add(path);\n        } else {\n            paths.delete(path);\n        }\n        this.setState({paths});\n    }\n\n    onUpdateClick = () => {\n        this.props.onChange(this.state.paths);\n    }\n\n    componentDidUpdate(prevProps) {\n        if (prevProps.selectedPaths !== this.props.selectedPaths) {\n            this.setState({paths: new Set(this.props.selectedPaths)});\n        }\n    }\n\n    render() {\n        if (!this.props.paths) {\n            return null;\n        }\n        let listItems = this.props.paths.sort().map(path => (\n            <li key={path}>\n              <label>\n                <Checkbox\n                  checked={this.props.selectedPaths.has(path)}\n                  value={path}\n                  onCheckboxChange={this.onCheckboxChange} />\n                {path}\n              </label>\n            </li>));\n        return [<dt key=\"term\">Test Paths</dt>,\n                (<dd key=\"value\">\n                   <button\n                     onClick={this.onUpdateClick}\n                     disabled={setsEqual(this.state.paths, this.props.selectedPaths)}>\n                     Update\n                   </button>\n                   <ul id=\"test-paths\">\n                     {listItems}\n                   </ul>\n                </dd>)];\n    }\n}\n\n\nclass ResultsView extends Component {\n    constructor(props) {\n        super(props);\n        this.defaultBrowsers = {\n            failsIn: [\"firefox\"],\n            passesIn: [\"chrome\", \"safari\"]\n        };\n        let comparison = this.getComparison();\n        this.state = {\n            loading_state: LOADING_STATE.NONE,\n            results: [],\n            filter: null,\n            filteredResults: null,\n            passesIn: comparison.passesIn,\n            failsIn: comparison.failsIn,\n        };\n    }\n\n    getComparison() {\n        let rv = {};\n        for (let [key, value] of Object.entries(this.defaultBrowsers)) {\n            rv[key] = value.slice();\n        }\n        for (let key of Object.keys(rv)) {\n            if (urlParams.has(key)) {\n                let value = urlParams.get(key);\n                let listValue = value.split(\",\").filter(x => browsers.includes(x));\n                if (!value.length || listValue.length) {\n                    rv[key] = listValue;\n                }\n            }\n        }\n        return rv;\n    }\n\n    buildQuery() {\n        let query = {\n            run_ids: this.props.runs.map(item => item.id),\n            query: {\n                and: []\n            }\n        };\n        let topAndClause = query.query.and;\n\n        for (let browser of this.state.failsIn) {\n            for (let status of passStatuses) {\n                topAndClause.push({not : {\n                    browser_name: browser,\n                    status: status\n                }});\n            }\n        }\n\n        for (let browser of this.state.passesIn) {\n            let target;\n            if (passStatuses.size > 1) {\n                let orClause = {or: []};\n                topAndClause.push(orClause);\n                target = orClause.or;\n            } else {\n                target = topAndClause;\n            }\n\n            for (let status of passStatuses) {\n                target.push({\n                    browser_name: browser,\n                    status: status\n                });\n            }\n        }\n\n        let paths = Array.from(this.props.paths);\n        if (paths.length > 1) {\n            topAndClause.push({\"or\": paths.map(path => {return {pattern: path + \"/\"};})});\n        } else {\n            topAndClause.push({pattern: paths[0]});\n        }\n\n        for (let term of this.props.queryTerms) {\n            topAndClause.push(term);\n        }\n\n        return query;\n    }\n\n    async fetchResults() {\n        let searchQuery = this.buildQuery();\n\n        let results;\n        try {\n            results = await fetchJson(makeWptFyiUrl(\"api/search\", {}), {\n                method: \"POST\",\n                body: JSON.stringify(searchQuery),\n                headers:{\n                    'Content-Type': 'application/json'\n                }\n            });\n        } catch(e) {\n            this.props.onError(e, {retry: async () => this.fetchResults()});\n            this.setState({loading_state: LOADING_STATE.COMPLETE});\n            throw e;\n        }\n\n        // The search for paths is \"contains\" so filter to only paths that start with the relevant\n        // directories\n\n        let pathRe = new RegExp(Array.from(this.props.paths).map(path => `^${path}/`).join(\"|\"));\n        results.results = results.results.filter(result => pathRe.test(result.test));\n\n        // TODO: should be able to do this more efficiently\n        results.results.forEach(result => {\n            result._wptMetadata = this.getWptMetadata(result.test);\n            result._geckoMetadata = this.getGeckoMetadata(result.test);\n        });\n\n        this.setState({results, loading_state: LOADING_STATE.COMPLETE});\n    }\n\n    getWptMetadata(test) {\n        let metadata = new Map();\n        if (this.props.wptMetadata[test]) {\n            for (let meta of this.props.wptMetadata[test]) {\n                let metaEntry = {...meta};\n                let product = metaEntry.product;\n                delete metaEntry.product;\n                if (!metadata.has(product)) {\n                    metadata.set(product, []);\n                }\n                metadata.get(product).push(metaEntry);\n            }\n        }\n        return metadata;\n    }\n\n    getGeckoMetadata(test) {\n        let metadata = new Map();\n        let dirParts = test.split(\"/\");\n        let testName = dirParts[dirParts.length - 1];\n        dirParts = dirParts.slice(1, dirParts.length - 1);\n        let dirPath = \"\";\n\n        function copyMeta(src) {\n            for (let [key, value] of Object.entries(src)) {\n                if (key[0] !== \"_\") {\n                    metadata.set(key, value);\n                }\n            }\n        }\n\n        for (let part of dirParts) {\n            if (dirPath.length) {\n                dirPath += \"/\";\n            }\n            dirPath += part;\n            let dirMeta = this.props.geckoMetadata[dirPath];\n            if (dirMeta) {\n                copyMeta(dirMeta);\n            }\n        }\n\n        let dirMetadata = this.props.geckoMetadata[dirPath];\n        if (dirMetadata && dirMetadata._tests && dirMetadata._tests[testName]) {\n            let testMetadata = dirMetadata._tests[testName];\n            copyMeta(testMetadata);\n            if (testMetadata._subtests) {\n                metadata._subtests = new Map();\n                for (let [key, value] of Object.entries(testMetadata._subtests)) {\n                    metadata._subtests.set(key, new Map(Object.entries(value)));\n                }\n            }\n        }\n        return metadata;\n    }\n\n    updateFilteredResults() {\n        let filteredResults;\n        if (!this.state.results) {\n            filteredResults = this.state.results;\n        } else if (!this.props.filter) {\n            filteredResults = this.state.results.results;\n        } else {\n            filteredResults = this.state.results.results.filter(x => this.props.filter(x));\n        }\n        this.setState({filteredResults});\n    }\n\n    onBrowserChange = (passesIn, failsIn) => {\n        this.setState({passesIn, failsIn});\n        for (let [key, values] of [[\"passesIn\", passesIn],\n                                   [\"failsIn\", failsIn]]) {\n            values = values.sort();\n            if (!arraysEqual(values, this.defaultBrowsers[key])) {\n                urlParams.set(key, values.join(\",\"));\n            } else {\n                urlParams.delete(key);\n            }\n        }\n    }\n\n    render() {\n        let data;\n        if (this.state.loading_state !== LOADING_STATE.COMPLETE) {\n           data = (<div>\n                      <p>Loading…</p>\n                    </div>);\n        } else if (this.state.results === null) {\n            data = (<div>\n                      <p>Load failed</p>\n                    </div>);\n        } else if (!this.state.results.results.length) {\n            data = (<div>\n                      <p>No results</p>\n                    </div>);\n        } else {\n            let results = this.state.filteredResults ? this.state.filteredResults : [];\n            let testItems = results.map(result => (<TestItem\n                                                     failsIn={this.state.failsIn}\n                                                     passesIn={this.state.passesIn}\n                                                     runs={this.props.runs}\n                                                     result={result}\n                                                     key={result.test}\n                                                     geckoMetadata={result._geckoMetadata || new Map()}\n                                                     wptMetadata={result._wptMetadata}\n                                                     onMetadataChange={this.props.onMetadataChange}\n                                                     onError={this.props.onError}/>));\n            testItems.sort((a,b) => (a.key > b.key ? 1 : (a.key === b.key ? 0 : -1)));\n            data = [(<p key=\"desc\">{results.length} top-level tests with\n                       &nbsp;{results\n                              .map(x => x.legacy_status[0].total)\n                              .reduce((x,y) => x+y, 0)} subtests</p>),\n                    <ul key=\"data\">{testItems}</ul>];\n        }\n        return (<div>\n                  {this.props.children}\n                  <ResultsViewSummary failsIn={this.state.failsIn}\n                                      passesIn={this.state.passesIn}\n                                      onChange={this.onBrowserChange}/>\n                  {data}\n                </div>);\n    }\n\n    async componentDidMount() {\n        await this.fetchIfPossible({}, {});\n    }\n\n    async componentDidUpdate(prevProps, prevState) {\n        await this.fetchIfPossible(prevProps, prevState);\n        if (prevState.filter !== this.state.filter) {\n            this.updateFilteredResults();\n        }\n    }\n\n    async fetchIfPossible(prevProps, prevState) {\n        if (this.state.loading_state === LOADING_STATE.LOADING) {\n            return;\n        }\n        if (this.props.runs === null) {\n            return;\n        }\n        if (!this.props.paths) {\n            return;\n        }\n        if (this.state.loading_state === LOADING_STATE.COMPLETE &&\n            this.props.paths === prevProps.paths &&\n            this.state.failsIn === prevState.failsIn &&\n            this.state.passesIn === prevState.passesIn &&\n            this.props.queryTerms === prevProps.queryTerms) {\n            return;\n        }\n        if (!this.props.paths.size) {\n            this.setState({results: {results: []},\n                           loading_state: LOADING_STATE.COMPLETE});\n            return;\n        }\n        this.setState({results: null,\n                       loading_state: LOADING_STATE.LOADING});\n        await this.fetchResults();\n        this.updateFilteredResults();\n    }\n}\n\nclass ResultsViewSummary extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            editable: false,\n            newPassesIn: this.props.passesIn,\n            newFailsIn: this.props.failsIn,\n        };\n    }\n\n    joinList(items) {\n        if (!items.length) {\n            return \"\";\n        }\n        if (items.length === 1) {\n            return items[0];\n        }\n        let commaSeparated = items.slice(0, items.length - 1).join(\", \");\n        return `${commaSeparated}, and ${items[items.length - 1]}`;\n    }\n\n    onEditClick = () => {\n        this.setState({editable: true});\n    }\n\n    onSelectChange = (data, type) => {\n        let key;\n        let state = {};\n        if (type === \"passesIn\") {\n            key = \"newPassesIn\";\n        } else if (type === \"failsIn\") {\n            key = \"newFailsIn\";\n        } else {\n            console.error(`Unknown key ${type}`);\n        }\n        state[key] = data;\n        this.setState(state);\n    }\n\n    onUpdateClick = () => {\n        this.props.onChange(this.state.newPassesIn, this.state.newFailsIn);\n        this.setState({editable: false});\n    }\n\n    render() {\n        if (!this.state.editable) {\n            let text;\n            if (this.props.passesIn.length && this.props.failsIn.length) {\n                text = `Tests that pass in ${this.joinList(this.props.passesIn.map(x => capitalize(x)))}\nbut not in ${this.joinList(this.props.failsIn.map(x => capitalize(x)))}`;\n            } else if (this.props.passesIn.length) {\n                text = `Tests that pass in ${this.joinList(this.props.passesIn.map(x => capitalize(x)))}`;\n            } else {\n                text = `Tests that don't pass in ${this.joinList(this.props.failsIn.map(x => capitalize(x)))}`;\n            }\n            return (<p>\n                      {text}\n                      &nbsp;\n                      <button onClick={this.onEditClick}>\n                        Edit\n                      </button>\n                    </p>);\n        } else {\n            let passInOptions = browsers.map(x => {return {\n                value: x,\n                name: capitalize(x),\n                selected: this.props.passesIn.includes(x)\n            };});\n            let failInOptions = browsers.map(x => {return {\n                value: x,\n                name: capitalize(x),\n                selected: this.props.failsIn.includes(x)\n            };});\n            return (<p>Tests that\n                      &nbsp;<label>pass in&nbsp;\n                        <SelectMultiple\n                          onChange={(data) => this.onSelectChange(data, \"passesIn\")}\n                          options={passInOptions}/>\n                      </label>\n                      &nbsp;but\n                      <label>\n                        &nbsp;not in&nbsp;\n                        <SelectMultiple\n                          onChange={(data) => this.onSelectChange(data, \"failsIn\")}\n                          options={failInOptions}/>\n                      </label>\n                      &nbsp;\n                      <button\n                        onClick={this.onUpdateClick}\n                        disabled={this.state.newPassesIn.length === 0 && this.state.newFailsIn.length === 0}>\n                        Update\n                      </button>\n                    </p>);\n        }\n    }\n}\n\nclass TreeRow extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            showDetails: props.expanded\n        };\n    }\n\n    handleClick = () => {\n        this.setState({showDetails: !this.state.showDetails});\n    }\n\n    render() {\n        return (<li\n                  className={\"tree-row\" + (this.state.showDetails ? \" tree-row-expanded\" : \"\")}\n                  id={this.props.rowId}\n                >\n                  <span onClick={this.handleClick}>\n                    {this.state.showDetails ? \"\\u25BC \" : \"\\u25B6 \"}\n                    {this.props.rowTitle}\n                  </span>\n                  {this.props.rowExtra}\n                  {this.state.showDetails ? (<div className=\"tree-row\">\n                                               {this.props.children}\n                                             </div>) : \"\"}\n               </li>);\n    }\n\n}\n\nclass TestItem extends Component {\n    render() {\n        // TODO: Difference between test path and file path\n        let rowTitle = `${this.props.result.test} [${this.props.result.legacy_status[0].total} subtests]`;\n        return (\n                <TreeRow rowTitle={<code>{rowTitle}</code>}\n                         rowId={this.props.result.test}\n                         expanded={window.location.hash.slice(1) === this.props.result.test}\n                         rowExtra={null}>\n                  <TestDetails\n                    runs={this.props.runs}\n                    test={this.props.result.test}\n                    passesIn={this.props.passesIn}\n                    failsIn={this.props.failsIn}\n                    geckoMetadata={this.props.geckoMetadata}\n                    wptMetadata={this.props.wptMetadata}\n                    onError={this.props.onError}\n                    onMetadataChange={this.props.onMetadataChange} />\n            </TreeRow>\n        );\n    }\n}\n\nclass TestDetails extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            loaded: false,\n            results: null\n        };\n    }\n\n    processResultData(results) {\n        let resultBySubtest = new Map();\n        for (let [browser, browserResults] of results) {\n            if (!resultBySubtest.has(null)) {\n                resultBySubtest.set(null, new Map());\n            }\n            resultBySubtest.get(null).set(browser, {status: browserResults.status,\n                                                    message: browserResults.message});\n            for (let subtest of browserResults.subtests) {\n                if (!resultBySubtest.has(subtest.name)) {\n                    resultBySubtest.set(subtest.name, new Map());\n                }\n                resultBySubtest.get(subtest.name).set(browser, {status: subtest.status,\n                                                                message: subtest.message});\n            }\n        }\n\n        for (let resultByBrowser of resultBySubtest.values()) {\n            for (let run of this.props.runs) {\n                let browser = run.browser_name;\n                if (!resultByBrowser.has(browser)) {\n                    resultByBrowser.set(browser, {status: \"MISSING\",\n                                                  message: null});\n                }\n            }\n        }\n\n        let filteredResultBySubtest = new Map();\n        // Filter out subtest results that don't match the current filters\n        for (let [subtest, resultByBrowser] of resultBySubtest) {\n            if (this.props.passesIn.every(browser => passStatuses.has(resultByBrowser.get(browser).status)) &&\n                this.props.failsIn.every(browser => !passStatuses.has(resultByBrowser.get(browser).status))) {\n                filteredResultBySubtest.set(subtest, resultByBrowser);\n            }\n        }\n\n        let rv = [];\n        if (filteredResultBySubtest.has(null)) {\n            rv.push([null, filteredResultBySubtest.get(null)]);\n            filteredResultBySubtest.delete(null);\n        }\n\n        return rv.concat(Array.from(filteredResultBySubtest));\n    }\n\n    async fetchData() {\n        let resultData = new Map();\n        let browsers = [];\n        let promises = [];\n        for (let run of this.props.runs) {\n            let browser = run.browser_name;\n            let summaryUrl = run.results_url;\n            let parts = summaryUrl.split('-');\n            // Remove the part of the url after the last -\n            parts.pop();\n            let url = `${parts.join('-')}${this.props.test}`;\n            let promise = fetchJson(url)\n                .then(x => {return {success: true, value:x};})\n                .catch(e => {return {success: false, value:e};});\n            browsers.push(browser);\n            promises.push(promise);\n        }\n        let resolved = await Promise.all(promises);\n        for (let [idx, data] of enumerate(resolved)) {\n            if (data.success) {\n                let browser = browsers[idx];\n                resultData.set(browser, data.value);\n            }\n        }\n        let filteredResults = this.processResultData(resultData);\n        this.setState({results: filteredResults,\n                       loaded: true});\n\n    }\n\n    async componentDidMount() {\n        await this.fetchData();\n    }\n\n    render() {\n        if (!this.state.loaded) {\n            return <p>Loading</p>;\n        }\n        let headerRow = this.props.runs.map(run => <th key={run.browser_name}>{run.browser_name}</th>);\n        headerRow.push(<th key=\"metadata\"></th>);\n        let subtestMetadata = this.props.geckoMetadata.get(\"_subtests\") || new Map();\n        let resultRows = this.state.results.map(([subtest, results]) => (<ResultRow\n                                                                           key={subtest}\n                                                                           runs={this.props.runs}\n                                                                           test={this.props.test}\n                                                                           subtest={subtest}\n                                                                           results={results}\n                                                                           geckoMetadata={subtestMetadata.get(subtest)}\n                                                                           wptMetadata={this.props.wptMetadata}\n                                                                           onMetadataChange={this.props.onMetadataChange} />));\n        return (<div>\n                  <section>\n                    <ul className=\"links\">\n                      <li><a href={`http://wpt.live${this.props.test}`}>View Test</a></li>\n                      <li><a href={makeWptFyiUrl(`results/${this.props.test}`)}>All Results</a></li>\n                      <li><a href={`http://searchfox.org/mozilla-central/source/testing/web-platform/meta${testToPath(this.props.test)}.ini`}>Gecko Metadata</a></li>\n                      <li>\n                        <WptTestMetadata\n                          test={this.props.test}\n                          subtest={null}\n                          wptMetadata={this.props.wptMetadata}\n                          onChange={this.props.onMetadataChange} />\n                      </li>\n                    </ul>\n                    <table className=\"results\">\n                      <thead>\n                        <tr>\n                          <th></th>\n                          {headerRow}\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {resultRows}\n                      </tbody>\n                    </table>\n                    <GeckoMetaSummary test={this.props.test}\n                                      geckoMetadata={this.props.geckoMetadata} />\n                  </section>\n                </div>);\n    }\n}\n\nclass WptTestMetadata extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            testMetadata: [],\n            addLink: false,\n            newLinkValue: null\n        };\n    }\n\n    componentDidMount() {\n        this.filterBugLinks();\n    }\n\n    onInputChange = (value) => {\n        this.setState({newLinkValue: value});\n    }\n\n    onAddLink = () => {\n        let bugUrl = `https://bugzilla.mozilla.org/show_bug.cgi?id=${this.state.newLinkValue}`;\n        this.props.onChange({test: this.props.test,\n                             subtest: this.props.subtest,\n                             change: \"ADD\",\n                             url: bugUrl});\n        let testMetadata = this.state.testMetadata.concat([{url: bugUrl}]);\n        this.setState({addLink: false, newLinkValue: null, testMetadata});\n    }\n\n    onRemoveLink = (url) => {\n        this.props.onChange({test: this.props.test,\n                             subtest: this.props.subtest,\n                             change: \"REMOVE\",\n                             url: url});\n        let testMetadata = this.state.testMetadata.filter(item => item.url !== url);\n        this.setState({testMetadata});\n    }\n\n    render() {\n        let bugLinks;\n        if (this.state.testMetadata.length) {\n            bugLinks = this.state.testMetadata.map(item => {\n                return <MetadataBugLink key={item.url}\n                                        url={item.url}\n                                        onRemove={this.onRemoveLink} />;\n            });\n        } else {\n            bugLinks = <span>None</span>;\n        }\n        let controlElements;\n        if (this.state.addLink) {\n            controlElements = (<div>\n                                 <TextInput\n                                   onChange={this.onInputChange}/>\n                                 <button onClick={this.onAddLink}>Add</button>\n                                 <button onClick={() => this.setState({addLink: false, newLinkValue: null})}>Cancel</button>\n                             </div>);\n        } else {\n            controlElements = <button onClick={() => this.setState({addLink: true})}>+</button>;\n        }\n        return (<div>\n                Gecko Bugs: {bugLinks}\n                  {controlElements}\n                </div>);\n    }\n\n    filterBugLinks() {\n        let fxMetadata = this.props.wptMetadata.get(\"firefox\");\n        if (!fxMetadata) {\n            return;\n        }\n        let testMetadata = [];\n        for (let meta of fxMetadata) {\n            if (!bugLinkRe.exec(meta.url)) {\n                continue;\n            }\n            if (!meta.results) {\n                if (!this.props.subtest) {\n                    testMetadata.push(meta);\n                }\n            } else {\n                let relevantResults = meta.results.filter(result => (!result.subtest && !this.props.subtest) ||\n                                                          (result.subtest === this.props.subtest));\n                if (relevantResults.length) {\n                    testMetadata.push({...meta, results: relevantResults});\n                }\n            }\n        }\n        this.setState({testMetadata});\n    }\n}\n\nclass MetadataBugLink extends Component {\n    render() {\n        return (<span>\n                <MaybeBugLink value={this.props.url} />\n                <button onClick={() => this.props.onRemove(this.props.url)}>-</button>\n                </span>);\n    }\n}\n\nclass GeckoMetaSummary extends Component {\n    render() {\n        let renderBug = value => <MaybeBugLink value={value} />;\n        let items = [];\n        if (this.props.geckoMetadata) {\n            let metaProps = [{name: \"disabled\", render: renderBug},\n                             {name: \"bug\", render: renderBug},\n                             {name: \"crash\", title: \"Crashes\", render: renderBug},\n                             {name: \"intermittent\", render: value => JSON.stringify(value)}];\n            for (let prop of metaProps) {\n                if (this.props.geckoMetadata.has(prop.name)) {\n                    items.push(<InlineOrTreeMetadata\n                                 key={prop.name}\n                                 title={prop.title ? prop.title : capitalize(prop.name)}\n                                 values={this.props.geckoMetadata.get(prop.name)}\n                                 render={prop.render}/>);\n                }\n            }\n        };\n        if (items.length === 0) {\n            return null;\n        }\n        return (<section>\n                  <h3>Gecko Metadata</h3>\n                  <ul>\n                    {items}\n                  </ul>\n                </section>);\n    }\n}\n\nclass InlineOrTreeMetadata extends Component {\n    render() {\n        if (!this.props.values) {\n            return null;\n        }\n        if (this.props.values.length === 1 && this.props.values[0][0] === null) {\n            // We have a single unconditional value for the property so render inline\n            return (<li>\n                      {this.props.title}: {this.props.render(this.props.values[0])}\n                    </li>);\n        } else {\n            return (<GeckoMetadataLine\n                      title={this.props.title}\n                      values={this.props.values}\n                      render={this.props.render}/>);\n        }\n    }\n}\n\nclass ResultRow extends Component {\n    render() {\n        let cells = this.props.runs.map(run => {\n            let result = this.props.results.get(run.browser_name);\n            return <ResultCell result={result} key={run.browser_name}/>;\n        });\n        cells.push(<td key=\"metadata\">\n                     <WptTestMetadata\n                       test={this.props.test}\n                       subtest={this.props.subtest}\n                       wptMetadata={this.props.wptMetadata}\n                       onChange={this.props.onMetadataChange} />\n                     <GeckoMetaSummary\n                       geckoMetadata={this.props.geckoMetadata} />\n                   </td>);\n        return (<tr>\n                  <th>{this.props.subtest ? this.props.subtest : \"<parent>\"}</th>\n                  {cells}\n                </tr>);\n    }\n}\n\nclass ResultCell extends Component {\n    render() {\n        return (<td\n                  className={`result result-${this.props.result.status.toLowerCase()}`}\n                  title={this.props.result.message}>\n                  {this.props.result.status}\n                </td>);\n    }\n}\n\nclass GeckoData extends Component {\n    groupData() {\n        let disabled = {unconditional: new Map(), conditional: new Map()};\n        let intermittent = {unconditional: new Map(), conditional: new Map()};\n        let lsan = {unconditional: new Map(), conditional: new Map()};\n        let crashes = {unconditional: new Map(), conditional: new Map()};\n        let set = (key, data, dest, mapFn) => {\n            let destKey;\n            if (!data || !data.length) {\n                return;\n            }\n            destKey = (data.length === 1 && (data[0] === null || data[0][0] === null)) ? \"unconditional\": \"conditional\";\n            if (mapFn) {\n                data = data.map(mapFn);\n            }\n            dest[destKey].set(key, data);\n        };\n        for (let [dir, dirData] of Object.entries(this.props.data)) {\n            set(dir, dirData.disabled, disabled);\n            set(dir, dirData['lsan-allowed'], lsan);\n            set(dir, dirData.expected_CRASH, crashes, cond => [cond, null]);\n            if (!dirData._tests) {\n                continue;\n            }\n            for (let [test, testData] of Object.entries(dirData._tests)) {\n                let testKey = `${dir}/${test}`;\n                set(testKey, testData.disabled, disabled);\n                set(testKey, testData.intermittent, intermittent);\n                set(testKey, testData.expected_CRASH, crashes, cond => [cond, null]);\n                if (!testData._subtests) {\n                    continue;\n                }\n                for (let [subtest, subtestData] of Object.entries(testData._subtests)) {\n                    let subtestKey = `${dir}/${test} | ${subtest}`;\n                    set(subtestKey, subtestData.disabled, disabled);\n                    set(subtestKey, subtestData.intermittent, intermittent);\n                    set(subtestKey, subtestData.expected_CRASH, crashes, cond => [cond, null]);\n                }\n            }\n        }\n        return {disabled, intermittent, lsan, crashes};\n    }\n\n    render() {\n        if (!this.props.data) {\n            return <p>Loading</p>;\n        }\n        let byType = this.groupData();\n        if (byType === null ||\n            !Object.values(byType).some(typeValues => Object.values(typeValues).some(x => x.size > 0))) {\n            return (<section>\n                      <h2>Gecko metadata</h2>\n                      <p>None</p>\n                      </section>);\n        }\n        return (<section>\n                  <h2>Gecko metadata</h2>\n                  <GeckoDataSection\n                    key=\"crashes\"\n                    data={byType.crashes}\n                    render={value => null}\n                    title=\"Crashes\"\n                    desc=\"tests crash\" />\n                  <GeckoDataSection\n                    key=\"disabled\"\n                    data={byType.disabled}\n                    render={value => <MaybeBugLink value={value} />}\n                    title=\"Disabled\"\n                    desc=\"tests are disabled\" />\n                  <GeckoDataSection\n                    key=\"intermittent\"\n                    data={byType.intermittent}\n                    render={value => <StatusListValue value={value} />}\n                    title=\"Intermittent\"\n                    desc=\"tests are intermittent\" />\n                  <GeckoDataSection\n                    key=\"lsan\"\n                    data={byType.lsan}\n                    render={value => <LsanListValue value={value} />}\n                    title=\"LSAN Failures\"\n                    desc=\"directories have LSAN failures\"/>\n                </section>);\n    }\n}\n\n\nclass GeckoDataSection extends Component {\n    render() {\n        let {conditional, unconditional} = this.props.data;\n        if (!conditional.size && !unconditional.size) {\n            return null;\n        }\n        let count = 0;\n        let items = [];\n        for (let [type, typeData] of [[\"In all configurations\", unconditional],\n                                      [\"In some configurations\", conditional]]) {\n            if (!typeData.size) {\n                continue;\n            }\n            items.push(<h4 key={type}>{type}</h4>);\n            for (let [test, values] of iterMapSorted(typeData)) {\n                count++;\n                items.push(<GeckoMetadataLine\n                             key={test}\n                             title={test}\n                             values={values}\n                             render={this.props.render}/>);\n            }\n        }\n        return (<section>\n                  <h3>{this.props.title}</h3>\n                  <p>{count} {this.props.desc}</p>\n                  <ul>{items}</ul>\n                </section>);\n    }\n\n}\n\nclass GeckoMetadataLine extends Component {\n    render() {\n        let values = [];\n        for (let [condition, value] of this.props.values) {\n            let conditionStr = condition ? `if ${condition}${value ? \": \" : \" \"}` : \"\";\n            values.push(<li\n                          key={condition ? condition : \"None\"}>\n                          <code>{conditionStr}</code>{value ? this.props.render(value): null}\n                        </li>);\n        }\n        let valueList = null;\n        if (values.length) {\n            valueList = <ul className=\"tree-row\">{values}</ul>;\n        }\n        return (<TreeRow\n                  rowTitle={this.props.title}\n                  rowExtra={null}>\n                  {valueList}\n                </TreeRow>);\n    }\n}\n\nclass MaybeBugLink extends Component {\n    render() {\n        const bugNumberRe = /(?:bug\\s+)?(\\d+)/i;\n        for (let re of [bugLinkRe, bugNumberRe]) {\n            let match = re.exec(this.props.value);\n            if (match !== null) {\n                return <a href={`https://bugzilla.mozilla.org/show_bug.cgi?id=${match[1]}`}>Bug {match[1]}</a>;\n            }\n        }\n        return this.props.value;\n    }\n}\n\nclass LsanListValue extends Component {\n    render() {\n        if (Array.isArray(this.props.value)) {\n            let frames = this.props.value.map(x => <li key={x}><code>{x}</code></li>);\n            return (<ul>{frames}</ul>);\n        }\n        return this.props.value;\n    }\n}\n\nclass StatusListValue extends Component {\n    render() {\n        if (Array.isArray(this.props.value)) {\n            let statuses = this.props.value.map(x => <code>{x}</code>)\n                .reduce((prev, current) => prev.length ? prev.concat([\", \", current]) : [current], []);\n            return (<code>{statuses}</code>);\n        }\n        return this.props.value;\n    }\n}\n\n\nclass Tabs extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            activeTab: urlParams.get('tab') || this.props.children[0].props.label\n        };\n    }\n\n    handleClickTab = (label) => {\n        this.setState({activeTab: label});\n        urlParams.set('tab', label);\n    }\n\n    render() {\n        let tabItems = this.props.children.map(child => {\n            let label = child.props.label;\n            return (<Tab\n                      active = {this.state.activeTab === label}\n                      label = {label}\n                      key = {label}\n                      onClick = {this.handleClickTab}\n                    />);\n        });\n        let activeTabContent = this.props.children.find(child => child.props.label === this.state.activeTab);\n        return (<div className=\"tab-view\">\n                  <ol className=\"tab-strip\">\n                    {tabItems}\n                  </ol>\n                  <div className=\"tab-content\">\n                    {activeTabContent}\n                  </div>\n                </div>);\n    }\n}\n\nclass Tab extends Component {\n    onClick = () => {\n        this.props.onClick(this.props.label);\n    }\n\n    render() {\n        return (<li\n                  className={\"tab-label \" + (this.props.active ? \"tab-active\" : \"\")}\n                  onClick={this.onClick}>\n                  {this.props.label}\n                </li>);\n    }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}